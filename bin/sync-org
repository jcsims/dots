#!/usr/bin/env bash

# Only attempt this if the screen is unlocked
if [ "$(/usr/libexec/PlistBuddy -c "print :IOConsoleUsers:0:CGSSessionScreenIsLocked" /dev/stdin 2>/dev/null <<< "$(ioreg -n Root -d1 -a)")" != "true" ]; then
    if curl -fq https://codeberg.org > /dev/null 2>&1; then
        cd ~/org || exit 1
        if ! ./sync; then
            echo "org sync failed! $(date)" >> "$HOME/problems"
        fi
    fi
fi
